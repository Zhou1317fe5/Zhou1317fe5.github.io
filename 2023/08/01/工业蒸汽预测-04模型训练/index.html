<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Zhou1317fe5"><meta name="keywords" content=""><meta name="description" content="数据处理 数据按02特征工程处理，此处不在赘述 导入数据 1234567891011import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport seaborn as snsfrom scipy import statsimport warningswarnings.filterwarnings(&amp;quo"><meta property="og:type" content="article"><meta property="og:title" content="工业蒸汽预测-04模型训练"><meta property="og:url" content="https://zhou1317fe5.github.io/2023/08/01/%E5%B7%A5%E4%B8%9A%E8%92%B8%E6%B1%BD%E9%A2%84%E6%B5%8B-04%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83/index.html"><meta property="og:site_name" content="Zhou1317fe5"><meta property="og:description" content="数据处理 数据按02特征工程处理，此处不在赘述 导入数据 1234567891011import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport seaborn as snsfrom scipy import statsimport warningswarnings.filterwarnings(&amp;quo"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://zhou1317fe5.github.io/img/%E5%B7%A5%E4%B8%9A%E8%92%B8%E6%B1%BD%E9%A2%84%E6%B5%8B-04%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83/output_6_0.png"><meta property="og:image" content="https://zhou1317fe5.github.io/img/%E5%B7%A5%E4%B8%9A%E8%92%B8%E6%B1%BD%E9%A2%84%E6%B5%8B-04%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83/output_13_0.png"><meta property="og:image" content="https://zhou1317fe5.github.io/img/%E5%B7%A5%E4%B8%9A%E8%92%B8%E6%B1%BD%E9%A2%84%E6%B5%8B-04%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83/output_16_0.png"><meta property="article:published_time" content="2023-08-01T11:50:38.000Z"><meta property="article:modified_time" content="2023-08-01T11:52:30.944Z"><meta property="article:author" content="Zhou1317fe5"><meta property="article:tag" content="机器学习"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://zhou1317fe5.github.io/img/%E5%B7%A5%E4%B8%9A%E8%92%B8%E6%B1%BD%E9%A2%84%E6%B5%8B-04%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83/output_6_0.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>工业蒸汽预测-04模型训练 - Zhou1317fe5</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/iconfont_csdn/iconfont.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"zhou1317fe5.github.io",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Zhou1317fe5</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/Post_banner_img.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="工业蒸汽预测-04模型训练"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-08-01 19:50" pubdate>2023年8月1日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 9.6k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 80 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">工业蒸汽预测-04模型训练</h1><div class="markdown-body"><h1 id="数据处理">数据处理</h1><p>数据按<code>02特征工程</code>处理，此处不在赘述</p><h2 id="导入数据">导入数据</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns<br><br><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats<br><br><span class="hljs-keyword">import</span> warnings<br>warnings.filterwarnings(<span class="hljs-string">&quot;ignore&quot;</span>)<br> <br>%matplotlib inline<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">train_data_file = <span class="hljs-string">&quot;./data/zhengqi_train.txt&quot;</span><br>test_data_file =  <span class="hljs-string">&quot;./data/zhengqi_test.txt&quot;</span><br><br>train_data = pd.read_csv(train_data_file, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>test_data = pd.read_csv(test_data_file, sep=<span class="hljs-string">&#x27;\t&#x27;</span>, encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="异常值分析">异常值分析</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.figure(figsize=(<span class="hljs-number">18</span>, <span class="hljs-number">10</span>))<br>plt.boxplot(x=train_data.values,labels=train_data.columns)<br>plt.hlines([-<span class="hljs-number">7.5</span>, <span class="hljs-number">7.5</span>], <span class="hljs-number">0</span>, <span class="hljs-number">40</span>, colors=<span class="hljs-string">&#x27;r&#x27;</span>)<br>plt.show()<br></code></pre></td></tr></table></figure><p><img src="/img/工业蒸汽预测-04模型训练/output_6_0.png" srcset="/img/loading.gif" lazyload></p><h2 id="删除异常值">删除异常值</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">train_data = train_data[train_data[<span class="hljs-string">&#x27;V9&#x27;</span>]&gt;-<span class="hljs-number">7.5</span>]<br><span class="hljs-comment"># print(train_data.describe())</span><br><span class="hljs-comment"># print(test_data.describe())</span><br></code></pre></td></tr></table></figure><h2 id="归一化">归一化</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> preprocessing <br><br>features_columns = [col <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> train_data.columns <span class="hljs-keyword">if</span> col <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;target&#x27;</span>]]<br><br>min_max_scaler = preprocessing.MinMaxScaler()<br><br>min_max_scaler = min_max_scaler.fit(train_data[features_columns])<br><br>train_data_scaler = min_max_scaler.transform(train_data[features_columns])<br>test_data_scaler = min_max_scaler.transform(test_data[features_columns])<br><br>train_data_scaler = pd.DataFrame(train_data_scaler)<br>train_data_scaler.columns = features_columns<br><br>test_data_scaler = pd.DataFrame(test_data_scaler)<br>test_data_scaler.columns = features_columns<br><br>train_data_scaler[<span class="hljs-string">&#x27;target&#x27;</span>] = train_data[<span class="hljs-string">&#x27;target&#x27;</span>]<br></code></pre></td></tr></table></figure><h2 id="查看数据分布情况">查看数据分布情况</h2><p>查看特征'V5', 'V17', 'V28', 'V22', 'V11', 'V9'数据的数据分布</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python">drop_col = <span class="hljs-number">6</span><br>drop_row = <span class="hljs-number">1</span><br><br>plt.figure(figsize=(<span class="hljs-number">5</span>*drop_col,<span class="hljs-number">5</span>*drop_row))<br><br><span class="hljs-keyword">for</span> i, col <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>([<span class="hljs-string">&quot;V5&quot;</span>,<span class="hljs-string">&quot;V9&quot;</span>,<span class="hljs-string">&quot;V11&quot;</span>,<span class="hljs-string">&quot;V17&quot;</span>,<span class="hljs-string">&quot;V22&quot;</span>,<span class="hljs-string">&quot;V28&quot;</span>]):<br>    ax =plt.subplot(drop_row,drop_col,i+<span class="hljs-number">1</span>)<br>    ax = sns.kdeplot(train_data_scaler[col], color=<span class="hljs-string">&quot;Red&quot;</span>, shade=<span class="hljs-literal">True</span>)<br>    ax= sns.kdeplot(test_data_scaler[col], color=<span class="hljs-string">&quot;Blue&quot;</span>, shade=<span class="hljs-literal">True</span>)<br>    ax.set_xlabel(col)<br>    ax.set_ylabel(<span class="hljs-string">&quot;Frequency&quot;</span>)<br>    ax = ax.legend([<span class="hljs-string">&quot;train&quot;</span>,<span class="hljs-string">&quot;test&quot;</span>])<br>plt.show()<br><br>data_train_scaler = train_data_scaler.drop([<span class="hljs-string">&#x27;V5&#x27;</span>,<span class="hljs-string">&#x27;V9&#x27;</span>,<span class="hljs-string">&#x27;V11&#x27;</span>,<span class="hljs-string">&#x27;V17&#x27;</span>,<span class="hljs-string">&#x27;V22&#x27;</span>,<span class="hljs-string">&#x27;V28&#x27;</span>],axis=<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><p><img src="/img/工业蒸汽预测-04模型训练/output_13_0.png" srcset="/img/loading.gif" lazyload></p><p>这几个特征下，训练集的数据和测试集的数据分布不一致，会影响模型的泛化能力，故删除这些特征</p><h2 id="特征相关性">特征相关性</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.figure(figsize=(<span class="hljs-number">20</span>, <span class="hljs-number">16</span>))  <br>column = train_data_scaler.columns.tolist()  <br>mcorr = train_data_scaler[column].corr(method=<span class="hljs-string">&quot;spearman&quot;</span>)  <br>mask = np.zeros_like(mcorr, dtype=np.<span class="hljs-built_in">bool</span>)  <br>mask[np.triu_indices_from(mask)] = <span class="hljs-literal">True</span>  <br>cmap = sns.diverging_palette(<span class="hljs-number">220</span>, <span class="hljs-number">10</span>, as_cmap=<span class="hljs-literal">True</span>)  <br>g = sns.heatmap(mcorr, mask=mask, cmap=cmap, square=<span class="hljs-literal">True</span>, annot=<span class="hljs-literal">True</span>, fmt=<span class="hljs-string">&#x27;0.2f&#x27;</span>)  <br>plt.show()<br></code></pre></td></tr></table></figure><p><img src="/img/工业蒸汽预测-04模型训练/output_16_0.png" srcset="/img/loading.gif" lazyload></p><h2 id="特征降维">特征降维</h2><h3 id="相关新分析">相关新分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">mcorr=mcorr.<span class="hljs-built_in">abs</span>()<br>numerical_corr=mcorr[mcorr[<span class="hljs-string">&#x27;target&#x27;</span>]&gt;<span class="hljs-number">0.1</span>][<span class="hljs-string">&#x27;target&#x27;</span>]<br><span class="hljs-built_in">print</span>(numerical_corr.sort_values(ascending=<span class="hljs-literal">False</span>))<br></code></pre></td></tr></table></figure><pre><code class="hljs">target    1.000000
V0        0.712403
V31       0.711636
V1        0.682909
V8        0.679469
V27       0.657398
V2        0.585850
V16       0.545793
V3        0.501622
V4        0.478683
V12       0.460300
V10       0.448682
V36       0.425991
V37       0.376443
V24       0.305526
V5        0.286076
V6        0.280195
V20       0.278381
V11       0.234551
V15       0.221290
V29       0.190109
V7        0.185321
V19       0.180111
V18       0.149741
V13       0.149199
V17       0.126262
V22       0.112743
V30       0.101378
Name: target, dtype: float64</code></pre><h3 id="相关性初筛">相关性初筛</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">features_corr = numerical_corr.sort_values(ascending=<span class="hljs-literal">False</span>).reset_index()<br>features_corr.columns = [<span class="hljs-string">&#x27;features_and_target&#x27;</span>, <span class="hljs-string">&#x27;corr&#x27;</span>]<br>features_corr_select = features_corr[features_corr[<span class="hljs-string">&#x27;corr&#x27;</span>]&gt;<span class="hljs-number">0.3</span>] <span class="hljs-comment"># 筛选出大于相关性大于0.3的特征</span><br><span class="hljs-built_in">print</span>(features_corr_select)<br>select_features = [col <span class="hljs-keyword">for</span> col <span class="hljs-keyword">in</span> features_corr_select[<span class="hljs-string">&#x27;features_and_target&#x27;</span>] <span class="hljs-keyword">if</span> col <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> [<span class="hljs-string">&#x27;target&#x27;</span>]]<br>new_train_data_corr_select = train_data_scaler[select_features+[<span class="hljs-string">&#x27;target&#x27;</span>]]<br>new_test_data_corr_select = test_data_scaler[select_features]<br></code></pre></td></tr></table></figure><pre><code class="hljs">   features_and_target      corr
0               target  1.000000
1                   V0  0.712403
2                  V31  0.711636
3                   V1  0.682909
4                   V8  0.679469
5                  V27  0.657398
6                   V2  0.585850
7                  V16  0.545793
8                   V3  0.501622
9                   V4  0.478683
10                 V12  0.460300
11                 V10  0.448682
12                 V36  0.425991
13                 V37  0.376443
14                 V24  0.305526</code></pre><h3 id="多重共线性分析">多重共线性分析</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> statsmodels.stats.outliers_influence <span class="hljs-keyword">import</span> variance_inflation_factor <span class="hljs-comment">#多重共线性方差膨胀因子</span><br><br><span class="hljs-comment">#多重共线性</span><br>new_numerical=[<span class="hljs-string">&#x27;V0&#x27;</span>, <span class="hljs-string">&#x27;V2&#x27;</span>, <span class="hljs-string">&#x27;V3&#x27;</span>, <span class="hljs-string">&#x27;V4&#x27;</span>, <span class="hljs-string">&#x27;V5&#x27;</span>, <span class="hljs-string">&#x27;V6&#x27;</span>, <span class="hljs-string">&#x27;V10&#x27;</span>,<span class="hljs-string">&#x27;V11&#x27;</span>, <br>                         <span class="hljs-string">&#x27;V13&#x27;</span>, <span class="hljs-string">&#x27;V15&#x27;</span>, <span class="hljs-string">&#x27;V16&#x27;</span>, <span class="hljs-string">&#x27;V18&#x27;</span>, <span class="hljs-string">&#x27;V19&#x27;</span>, <span class="hljs-string">&#x27;V20&#x27;</span>, <span class="hljs-string">&#x27;V22&#x27;</span>,<span class="hljs-string">&#x27;V24&#x27;</span>,<span class="hljs-string">&#x27;V30&#x27;</span>, <span class="hljs-string">&#x27;V31&#x27;</span>, <span class="hljs-string">&#x27;V37&#x27;</span>]<br>X=np.matrix(train_data_scaler[new_numerical])<br>VIF_list=[variance_inflation_factor(X, i) <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(X.shape[<span class="hljs-number">1</span>])]<br>VIF_list<br></code></pre></td></tr></table></figure><pre><code class="hljs">[216.73387180903222,
 114.38118723828812,
 27.863778129686356,
 201.96436579080174,
 78.93722825798903,
 151.06983667656212,
 14.519604941508451,
 82.69750284665385,
 28.479378440614585,
 27.759176471505945,
 526.6483470743831,
 23.50166642638334,
 19.920315849901424,
 24.640481765008683,
 11.816055964845381,
 4.958208708452915,
 37.09877416736591,
 298.26442986612767,
 47.854002539887034]</code></pre><h3 id="pca降维">PCA降维</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.decomposition <span class="hljs-keyword">import</span> PCA   <span class="hljs-comment">#主成分分析法</span><br><span class="hljs-comment">#PCA方法降维</span><br><span class="hljs-comment">#保留16个主成分</span><br>pca = PCA(n_components=<span class="hljs-number">16</span>)<br>new_train_pca_16 = pca.fit_transform(train_data_scaler.iloc[:,<span class="hljs-number">0</span>:-<span class="hljs-number">1</span>])<br>new_test_pca_16 = pca.transform(test_data_scaler)<br>new_train_pca_16 = pd.DataFrame(new_train_pca_16)<br>new_test_pca_16 = pd.DataFrame(new_test_pca_16)<br>new_train_pca_16[<span class="hljs-string">&#x27;target&#x27;</span>] = train_data_scaler[<span class="hljs-string">&#x27;target&#x27;</span>]<br>new_train_pca_16.describe()<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>0</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th><th>12</th><th>13</th><th>14</th><th>15</th><th>target</th></tr></thead><tbody><tr><th>count</th><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2.886000e+03</td><td>2884.000000</td></tr><tr><th>mean</th><td>-8.309602e-17</td><td>-5.653059e-17</td><td>7.698662e-17</td><td>1.023282e-16</td><td>1.123303e-17</td><td>-2.096575e-17</td><td>1.186440e-16</td><td>2.303347e-17</td><td>-8.889286e-17</td><td>7.044204e-17</td><td>2.085635e-17</td><td>7.888604e-17</td><td>1.061271e-17</td><td>-8.522866e-17</td><td>-3.927472e-18</td><td>1.403527e-16</td><td>0.127274</td></tr><tr><th>std</th><td>3.998976e-01</td><td>3.500240e-01</td><td>2.938631e-01</td><td>2.728023e-01</td><td>2.077128e-01</td><td>1.951842e-01</td><td>1.877104e-01</td><td>1.607670e-01</td><td>1.512707e-01</td><td>1.443772e-01</td><td>1.368790e-01</td><td>1.286192e-01</td><td>1.193301e-01</td><td>1.149758e-01</td><td>1.133507e-01</td><td>1.019258e-01</td><td>0.983462</td></tr><tr><th>min</th><td>-1.071795e+00</td><td>-9.429479e-01</td><td>-9.948314e-01</td><td>-7.103085e-01</td><td>-7.703982e-01</td><td>-5.340293e-01</td><td>-5.993765e-01</td><td>-5.870824e-01</td><td>-6.282791e-01</td><td>-4.902512e-01</td><td>-6.340717e-01</td><td>-5.906511e-01</td><td>-4.174969e-01</td><td>-4.310403e-01</td><td>-4.170661e-01</td><td>-3.599371e-01</td><td>-3.044000</td></tr><tr><th>25%</th><td>-2.804085e-01</td><td>-2.613727e-01</td><td>-2.090798e-01</td><td>-1.945196e-01</td><td>-1.315622e-01</td><td>-1.264097e-01</td><td>-1.236367e-01</td><td>-1.016457e-01</td><td>-9.662180e-02</td><td>-9.297320e-02</td><td>-8.202288e-02</td><td>-7.721862e-02</td><td>-7.139615e-02</td><td>-7.473615e-02</td><td>-7.710889e-02</td><td>-6.599455e-02</td><td>-0.348500</td></tr><tr><th>50%</th><td>-1.417104e-02</td><td>-1.277241e-02</td><td>2.112159e-02</td><td>-2.337402e-02</td><td>-5.122768e-03</td><td>-1.355318e-02</td><td>-1.749546e-04</td><td>-4.655494e-03</td><td>2.574985e-03</td><td>-1.480464e-03</td><td>7.296441e-03</td><td>-5.733519e-03</td><td>-4.165757e-03</td><td>1.036940e-03</td><td>-1.762762e-03</td><td>-7.954922e-04</td><td>0.313000</td></tr><tr><th>75%</th><td>2.287306e-01</td><td>2.317720e-01</td><td>2.069571e-01</td><td>1.657590e-01</td><td>1.281659e-01</td><td>9.993165e-02</td><td>1.272086e-01</td><td>9.657155e-02</td><td>1.002626e-01</td><td>9.059782e-02</td><td>8.835004e-02</td><td>7.147987e-02</td><td>6.785346e-02</td><td>7.576130e-02</td><td>7.115629e-02</td><td>6.364658e-02</td><td>0.794250</td></tr><tr><th>max</th><td>1.597730e+00</td><td>1.382802e+00</td><td>1.010250e+00</td><td>1.448007e+00</td><td>1.034062e+00</td><td>1.358963e+00</td><td>6.191591e-01</td><td>7.370069e-01</td><td>6.449190e-01</td><td>5.839583e-01</td><td>6.404954e-01</td><td>6.780797e-01</td><td>5.156587e-01</td><td>4.977880e-01</td><td>4.675102e-01</td><td>4.571981e-01</td><td>2.538000</td></tr></tbody></table></div><h1 id="模型训练">模型训练</h1><h2 id="导入相关库">1 导入相关库</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> sklearn.linear_model <span class="hljs-keyword">import</span> LinearRegression  <span class="hljs-comment">#线性回归</span><br><span class="hljs-keyword">from</span> sklearn.neighbors <span class="hljs-keyword">import</span> KNeighborsRegressor  <span class="hljs-comment">#K近邻回归</span><br><span class="hljs-keyword">from</span> sklearn.tree <span class="hljs-keyword">import</span> DecisionTreeRegressor     <span class="hljs-comment">#决策树回归</span><br><span class="hljs-keyword">from</span> sklearn.ensemble <span class="hljs-keyword">import</span> RandomForestRegressor <span class="hljs-comment">#随机森林回归</span><br><span class="hljs-keyword">from</span> sklearn.svm <span class="hljs-keyword">import</span> SVR  <span class="hljs-comment">#支持向量回归</span><br><span class="hljs-keyword">import</span> lightgbm <span class="hljs-keyword">as</span> lgb <span class="hljs-comment">#lightGbm模型</span><br><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split <span class="hljs-comment"># 切分数据</span><br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> mean_squared_error <span class="hljs-comment">#评价指标</span><br><br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> learning_curve<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> ShuffleSplit<br><br></code></pre></td></tr></table></figure><h2 id="切分数据">2 切分数据</h2><p>对训练集进行切分，得到80%的训练数据和20%的验证数据。用切分得到的训练数据训练模型，用切分得到的验证数据评估模型的性能优劣。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#采用 pca 保留16维特征的数据</span><br>new_train_pca_16 = new_train_pca_16.fillna(<span class="hljs-number">0</span>)<br>train = new_train_pca_16[new_test_pca_16.columns]<br>target = new_train_pca_16[<span class="hljs-string">&#x27;target&#x27;</span>]<br><br><span class="hljs-comment"># 切分数据 训练数据80% 验证数据20%</span><br>train_data,test_data,train_target,test_target=train_test_split(train,target,test_size=<span class="hljs-number">0.2</span>,random_state=<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><h2 id="多元线性回归模型">3 多元线性回归模型</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">clf = LinearRegression()<br>clf.fit(train_data, train_target)<br>score = mean_squared_error(test_target, clf.predict(test_data))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;LinearRegression:   &quot;</span>, score)<br></code></pre></td></tr></table></figure><pre><code class="hljs">LinearRegression:    0.271697499977603</code></pre><p>优点：模型简单，部署方便，回归权重可以用于结果分析；训练快。</p><p>缺点：精度低，特征存在一定的共线性问题。</p><p>使用技巧：需要进行<strong>归一化</strong>处理，建议进行一定的特征选择，尽量避免高度相关的特征同时存在。</p><p>本题结果：效果一般，适合分析使用。</p><h2 id="k近邻回归">4 K近邻回归</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">clf = KNeighborsRegressor(n_neighbors=<span class="hljs-number">8</span>) <span class="hljs-comment"># 最近8个</span><br>clf.fit(train_data, train_target)<br>score = mean_squared_error(test_target, clf.predict(test_data))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;KNeighborsRegressor:   &quot;</span>, score)<br></code></pre></td></tr></table></figure><pre><code class="hljs">KNeighborsRegressor:    0.2734753438581315</code></pre><p>优点：模型简单，易于理解，对于数据量小的情况方便快捷，可视化方便。</p><p>缺点：计算量大，不适合数据量大的情况：需要调参数。</p><p>使用技巧：特征需要<strong>归一化</strong>，重要的特征可以适当加一定比例的权重。</p><p>本题结果：效果一般。</p><h2 id="随机森林回归">5 随机森林回归</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">clf = RandomForestRegressor(n_estimators=<span class="hljs-number">200</span>) <span class="hljs-comment"># 200棵树模型</span><br>clf.fit(train_data, train_target)<br>score = mean_squared_error(test_target, clf.predict(test_data))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;RandomForestRegressor:   &quot;</span>, score)<br></code></pre></td></tr></table></figure><pre><code class="hljs">RandomForestRegressor:    0.2477930646584775</code></pre><p>优点：使用方便，特征<strong>无须做过多变换</strong>；精度较高：模型并行训练快。</p><p>缺点：结果不容易解释。</p><p>使用技巧：参数调节，提高精度。</p><p>本题结果：比较适合。</p><h2 id="lgb模型回归">6 LGB模型回归</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># lgb回归模型</span><br>clf = lgb.LGBMRegressor(<br>        learning_rate=<span class="hljs-number">0.01</span>, <span class="hljs-comment"># 学习率</span><br>        max_depth=-<span class="hljs-number">1</span>, <span class="hljs-comment"># 树的最大深度。-1表示没有限制。</span><br>        n_estimators=<span class="hljs-number">5000</span>, <span class="hljs-comment"># 迭代次数，也就是基础模型（决策树）的数量。</span><br>        boosting_type=<span class="hljs-string">&#x27;gbdt&#x27;</span>, <span class="hljs-comment"># 提升类型，默认为&#x27;gbdt&#x27;，表示梯度提升决策树。</span><br>        random_state=<span class="hljs-number">2019</span>, <span class="hljs-comment"># 随机种子，用于重现结果。</span><br>        objective=<span class="hljs-string">&#x27;regression&#x27;</span>, <span class="hljs-comment"># 化目标，这里设置为&#x27;regression&#x27;表示回归问题。</span><br>    )<br><br><span class="hljs-comment"># 训练模型</span><br>clf.fit(<br>        X=train_data, y=train_target,<br>        eval_metric=<span class="hljs-string">&#x27;MSE&#x27;</span>, <span class="hljs-comment"># 设置评估指标eval_metric，这里使用均方误差（MSE）</span><br>        <span class="hljs-comment"># verbose=50 # 控制训练过程中的输出信息，50表示每50轮输出一次。</span><br>    )<br><br>score = mean_squared_error(test_target, clf.predict(test_data))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;lightGbm:   &quot;</span>, score)<br></code></pre></td></tr></table></figure><pre><code class="hljs">[LightGBM] [Warning] Auto-choosing col-wise multi-threading, the overhead of testing was 0.000303 seconds.
You can set `force_col_wise=true` to remove the overhead.
[LightGBM] [Info] Total Bins 4080
[LightGBM] [Info] Number of data points in the train set: 2308, number of used features: 16
[LightGBM] [Info] Start training from score 0.119128
lightGbm:    0.2436390703800861</code></pre><p>优点：精度高。</p><p>缺点：训练时间长，模型复杂。</p><p>使用技巧：有效的验证集防止过拟合；参数搜索。</p><p>本题结果：适用。</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8/" class="category-chain-item">机器学习实战入门</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">#机器学习</a></div></div><div class="license-box my-3"><div class="license-title"><div>工业蒸汽预测-04模型训练</div><div>https://zhou1317fe5.github.io/2023/08/01/工业蒸汽预测-04模型训练/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Zhou1317fe5</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年8月1日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2023/08/30/C%E8%AF%AD%E8%A8%8001-C%E8%AF%AD%E8%A8%80%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86123/" title="C语言01-C语言的基础知识123"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">C语言01-C语言的基础知识123</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/07/31/%E5%B7%A5%E4%B8%9A%E8%92%B8%E6%B1%BD%E9%A2%84%E6%B5%8B-03%E7%89%B9%E5%BE%81%E5%B7%A5%E7%A8%8B/" title="工业蒸汽预测-03特征工程"><span class="hidden-mobile">工业蒸汽预测-03特征工程</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>