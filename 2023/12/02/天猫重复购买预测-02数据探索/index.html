<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="auto"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="Zhou1317fe5"><meta name="keywords" content=""><meta name="description" content="1 工具导入和数据读取 工具导入 12345678910import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport seaborn as snsfrom scipy import statsimport warningswarnings.filterwarnings(&quot;ignore&quot;)"><meta property="og:type" content="article"><meta property="og:title" content="天猫重复购买预测-02数据探索"><meta property="og:url" content="http://zhou1317fe5.link/2023/12/02/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/index.html"><meta property="og:site_name" content="Zhou1317fe5"><meta property="og:description" content="1 工具导入和数据读取 工具导入 12345678910import numpy as npimport pandas as pdimport matplotlib.pyplot as pltimport seaborn as snsfrom scipy import statsimport warningswarnings.filterwarnings(&quot;ignore&quot;)"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_37_2.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_43_1.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_48_0.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_53_0.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_57_0.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_61_0.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_65_0.png"><meta property="og:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_68_0.png"><meta property="article:published_time" content="2023-12-02T01:32:33.000Z"><meta property="article:modified_time" content="2023-12-02T01:35:13.596Z"><meta property="article:author" content="Zhou1317fe5"><meta property="article:tag" content="机器学习"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="http://zhou1317fe5.link/img/%E5%A4%A9%E7%8C%AB%E9%87%8D%E5%A4%8D%E8%B4%AD%E4%B9%B0%E9%A2%84%E6%B5%8B-02%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/output_37_2.png"><meta name="referrer" content="no-referrer-when-downgrade"><title>天猫重复购买预测-02数据探索 - Zhou1317fe5</title><link rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><link rel="stylesheet" href="/css/iconfont_csdn/iconfont.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"zhou1317fe5.link",root:"/",version:"1.9.4",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"right",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:null,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1}},search_path:"/local-search.xml"};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css"><meta name="generator" content="Hexo 6.3.0"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Zhou1317fe5</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/Post_banner_img.jpg) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="天猫重复购买预测-02数据探索"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2023-12-02 09:32" pubdate>2023年12月2日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 12k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 102 分钟 </span><span id="busuanzi_container_page_pv" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="busuanzi_value_page_pv"></span> 次</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 style="display:none">天猫重复购买预测-02数据探索</h1><div class="markdown-body"><h2 id="工具导入和数据读取">1 工具导入和数据读取</h2><h3 id="工具导入">工具导入</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt<br><span class="hljs-keyword">import</span> seaborn <span class="hljs-keyword">as</span> sns<br><span class="hljs-keyword">from</span> scipy <span class="hljs-keyword">import</span> stats<br><br><span class="hljs-keyword">import</span> warnings<br>warnings.filterwarnings(<span class="hljs-string">&quot;ignore&quot;</span>)<br> <br>%matplotlib inline<br></code></pre></td></tr></table></figure><h3 id="数据读取">数据读取</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">读取数据集</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>test_data = pd.read_csv(<span class="hljs-string">&#x27;./data/data_format1/test_format1.csv&#x27;</span>)<br>train_data = pd.read_csv(<span class="hljs-string">&#x27;./data/data_format1/train_format1.csv&#x27;</span>)<br><br>user_info = pd.read_csv(<span class="hljs-string">&#x27;./data/data_format1/user_info_format1.csv&#x27;</span>)<br>user_log = pd.read_csv(<span class="hljs-string">&#x27;./data/data_format1/user_log_format1.csv&#x27;</span>)<br><br><span class="hljs-comment">#user_info = pd.read_csv(&#x27;./data_format1/user_info_format1.csv&#x27;).drop_duplicates()</span><br><span class="hljs-comment">#user_log = pd.read_csv(&#x27;./data_format1/user_log_format1.csv&#x27;).rename(columns=&#123;&quot;seller_id&quot;:&#x27;merchant_id&#x27;&#125;)</span><br><br></code></pre></td></tr></table></figure><h3 id="数据集样例查看">数据集样例查看</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">train_data.head(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th><th>merchant_id</th><th>label</th></tr></thead><tbody><tr><th>0</th><td>34176</td><td>3906</td><td>0</td></tr><tr><th>1</th><td>34176</td><td>121</td><td>0</td></tr><tr><th>2</th><td>34176</td><td>4356</td><td>1</td></tr><tr><th>3</th><td>34176</td><td>2217</td><td>0</td></tr><tr><th>4</th><td>230784</td><td>4818</td><td>0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">test_data.head(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th><th>merchant_id</th><th>prob</th></tr></thead><tbody><tr><th>0</th><td>163968</td><td>4605</td><td>NaN</td></tr><tr><th>1</th><td>360576</td><td>1581</td><td>NaN</td></tr><tr><th>2</th><td>98688</td><td>1964</td><td>NaN</td></tr><tr><th>3</th><td>98688</td><td>3645</td><td>NaN</td></tr><tr><th>4</th><td>295296</td><td>3361</td><td>NaN</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info.head(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th><th>age_range</th><th>gender</th></tr></thead><tbody><tr><th>0</th><td>376517</td><td>6.0</td><td>1.0</td></tr><tr><th>1</th><td>234512</td><td>5.0</td><td>0.0</td></tr><tr><th>2</th><td>344532</td><td>5.0</td><td>0.0</td></tr><tr><th>3</th><td>186135</td><td>5.0</td><td>0.0</td></tr><tr><th>4</th><td>30230</td><td>5.0</td><td>0.0</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_log.head(<span class="hljs-number">5</span>)<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th><th>item_id</th><th>cat_id</th><th>seller_id</th><th>brand_id</th><th>time_stamp</th><th>action_type</th></tr></thead><tbody><tr><th>0</th><td>328862</td><td>323294</td><td>833</td><td>2882</td><td>2661.0</td><td>829</td><td>0</td></tr><tr><th>1</th><td>328862</td><td>844400</td><td>1271</td><td>2882</td><td>2661.0</td><td>829</td><td>0</td></tr><tr><th>2</th><td>328862</td><td>575153</td><td>1271</td><td>2882</td><td>2661.0</td><td>829</td><td>0</td></tr><tr><th>3</th><td>328862</td><td>996875</td><td>1271</td><td>2882</td><td>2661.0</td><td>829</td><td>0</td></tr><tr><th>4</th><td>328862</td><td>1086186</td><td>1271</td><td>1253</td><td>1049.0</td><td>829</td><td>0</td></tr></tbody></table></div><h2 id="单变量数据分析">2 单变量数据分析</h2><h3 id="数据类型和数据大小">2.1 数据类型和数据大小</h3><p><strong>用户信息数据</strong></p><ol type="1"><li>数据集中共有2个float64类型和1个int64类型的数据</li><li>数据大小9.7MB</li><li>数据集共有424170条数据</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info.info()<br></code></pre></td></tr></table></figure><pre><code class="hljs">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 424170 entries, 0 to 424169
Data columns (total 3 columns):
 #   Column     Non-Null Count   Dtype  
---  ------     --------------   -----  
 0   user_id    424170 non-null  int64  
 1   age_range  421953 non-null  float64
 2   gender     417734 non-null  float64
dtypes: float64(2), int64(1)
memory usage: 9.7 MB</code></pre><p><strong>用户行为数据</strong></p><ol type="1"><li>数据集中共有6个int64类型和1个float64类型的数据</li><li>数据大小2.9GB</li><li>数据集共有54925330条数据</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_log.info()<br></code></pre></td></tr></table></figure><pre><code class="hljs">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 54925330 entries, 0 to 54925329
Data columns (total 7 columns):
 #   Column       Dtype  
---  ------       -----  
 0   user_id      int64  
 1   item_id      int64  
 2   cat_id       int64  
 3   seller_id    int64  
 4   brand_id     float64
 5   time_stamp   int64  
 6   action_type  int64  
dtypes: float64(1), int64(6)
memory usage: 2.9 GB</code></pre><p><strong>用户购买训练数据</strong></p><ol type="1"><li>数据均为int64类型</li><li>数据大小6MB</li><li>数据集共有260864条数据</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">train_data.info()<br></code></pre></td></tr></table></figure><pre><code class="hljs">&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 260864 entries, 0 to 260863
Data columns (total 3 columns):
 #   Column       Non-Null Count   Dtype
---  ------       --------------   -----
 0   user_id      260864 non-null  int64
 1   merchant_id  260864 non-null  int64
 2   label        260864 non-null  int64
dtypes: int64(3)
memory usage: 6.0 MB</code></pre><h3 id="缺失值查看">2.2 缺失值查看</h3><p>使用Pandas中count()函数及shape()函数进行统计：count()函数可以统计不为空数据的个数；shape()函数则可以统计数据样本的个数；将shape()函数与count()函数做差就可以得到数据的缺失个数，再用缺失的个数除以样本的个数来计算样本中此字段的缺失率。</p><p><strong>（1）用户信息数据缺失，年龄值缺失情况</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">(user_info.shape[<span class="hljs-number">0</span>]-user_info[<span class="hljs-string">&#x27;age_range&#x27;</span>].count())/user_info.shape[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><pre><code class="hljs">0.005226677982884221</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info[user_info[<span class="hljs-string">&#x27;age_range&#x27;</span>].isna() | (user_info[<span class="hljs-string">&#x27;age_range&#x27;</span>] == <span class="hljs-number">0</span>)].count()<br></code></pre></td></tr></table></figure><pre><code class="hljs">user_id      95131
age_range    92914
gender       90664
dtype: int64</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info.groupby([<span class="hljs-string">&#x27;age_range&#x27;</span>])[[<span class="hljs-string">&#x27;user_id&#x27;</span>]].count()<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th></tr><tr><th>age_range</th><th></th></tr></thead><tbody><tr><th>0.0</th><td>92914</td></tr><tr><th>1.0</th><td>24</td></tr><tr><th>2.0</th><td>52871</td></tr><tr><th>3.0</th><td>111654</td></tr><tr><th>4.0</th><td>79991</td></tr><tr><th>5.0</th><td>40777</td></tr><tr><th>6.0</th><td>35464</td></tr><tr><th>7.0</th><td>6992</td></tr><tr><th>8.0</th><td>1266</td></tr></tbody></table></div><ol type="1"><li>年龄值为空的缺失率为0.5%</li><li>年龄值缺失或者年龄值默认为0时，可认为数据缺失</li><li>有缺失值的数据共计95131条数据</li></ol><p><strong>（2）查看性别缺失情况</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">(user_info.shape[<span class="hljs-number">0</span>]-user_info[<span class="hljs-string">&#x27;gender&#x27;</span>].count())/user_info.shape[<span class="hljs-number">0</span>]<br></code></pre></td></tr></table></figure><pre><code class="hljs">0.01517316170403376</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info[user_info[<span class="hljs-string">&#x27;gender&#x27;</span>].isna() | (user_info[<span class="hljs-string">&#x27;gender&#x27;</span>] == <span class="hljs-number">2</span>)].count()<br></code></pre></td></tr></table></figure><pre><code class="hljs">user_id      16862
age_range    14664
gender       10426
dtype: int64</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info.groupby([<span class="hljs-string">&#x27;gender&#x27;</span>])[[<span class="hljs-string">&#x27;user_id&#x27;</span>]].count()<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th></tr><tr><th>gender</th><th></th></tr></thead><tbody><tr><th>0.0</th><td>285638</td></tr><tr><th>1.0</th><td>121670</td></tr><tr><th>2.0</th><td>10426</td></tr></tbody></table></div><ol type="1"><li><p>性别值为空的缺失率 1.5%</p></li><li><p>当性别值缺失或者性别值默认为2时，可认为该数据缺失</p></li><li><p>有缺失值的数据共计16862条数据</p></li></ol><p><strong>（3）查看年龄或者性别其中有一个有缺失的情况</strong></p><p>共计106330条数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info[user_info[<span class="hljs-string">&#x27;age_range&#x27;</span>].isna() | (user_info[<span class="hljs-string">&#x27;age_range&#x27;</span>] == <span class="hljs-number">0</span>) | user_info[<span class="hljs-string">&#x27;gender&#x27;</span>].isna() | (user_info[<span class="hljs-string">&#x27;gender&#x27;</span>] == <span class="hljs-number">2</span>)].count()<br></code></pre></td></tr></table></figure><pre><code class="hljs">user_id      106330
age_range    104113
gender        99894
dtype: int64</code></pre><p><strong>（4）用户行为日志信息</strong></p><p>brand_id字段有91015条缺失数据</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_log.isna().<span class="hljs-built_in">sum</span>()<br></code></pre></td></tr></table></figure><pre><code class="hljs">user_id            0
item_id            0
cat_id             0
seller_id          0
brand_id       91015
time_stamp         0
action_type        0
dtype: int64</code></pre><h2 id="观察数据分布">3 观察数据分布</h2><h3 id="整体数据统计信息">3.1 整体数据统计信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_info.describe()<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th><th>age_range</th><th>gender</th></tr></thead><tbody><tr><th>count</th><td>424170.000000</td><td>421953.000000</td><td>417734.000000</td></tr><tr><th>mean</th><td>212085.500000</td><td>2.930262</td><td>0.341179</td></tr><tr><th>std</th><td>122447.476178</td><td>1.942978</td><td>0.524112</td></tr><tr><th>min</th><td>1.000000</td><td>0.000000</td><td>0.000000</td></tr><tr><th>25%</th><td>106043.250000</td><td>2.000000</td><td>0.000000</td></tr><tr><th>50%</th><td>212085.500000</td><td>3.000000</td><td>0.000000</td></tr><tr><th>75%</th><td>318127.750000</td><td>4.000000</td><td>1.000000</td></tr><tr><th>max</th><td>424170.000000</td><td>8.000000</td><td>2.000000</td></tr></tbody></table></div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">user_log.describe()<br></code></pre></td></tr></table></figure><div><style scoped>.dataframe tbody tr th:only-of-type{vertical-align:middle}.dataframe tbody tr th{vertical-align:top}.dataframe thead th{text-align:right}</style><table border="1" class="dataframe"><thead><tr style="text-align:right"><th></th><th>user_id</th><th>item_id</th><th>cat_id</th><th>seller_id</th><th>brand_id</th><th>time_stamp</th><th>action_type</th></tr></thead><tbody><tr><th>count</th><td>5.492533e+07</td><td>5.492533e+07</td><td>5.492533e+07</td><td>5.492533e+07</td><td>5.483432e+07</td><td>5.492533e+07</td><td>5.492533e+07</td></tr><tr><th>mean</th><td>2.121568e+05</td><td>5.538613e+05</td><td>8.770308e+02</td><td>2.470941e+03</td><td>4.153348e+03</td><td>9.230953e+02</td><td>2.854458e-01</td></tr><tr><th>std</th><td>1.222872e+05</td><td>3.221459e+05</td><td>4.486269e+02</td><td>1.473310e+03</td><td>2.397679e+03</td><td>1.954305e+02</td><td>8.075806e-01</td></tr><tr><th>min</th><td>1.000000e+00</td><td>1.000000e+00</td><td>1.000000e+00</td><td>1.000000e+00</td><td>1.000000e+00</td><td>5.110000e+02</td><td>0.000000e+00</td></tr><tr><th>25%</th><td>1.063360e+05</td><td>2.731680e+05</td><td>5.550000e+02</td><td>1.151000e+03</td><td>2.027000e+03</td><td>7.300000e+02</td><td>0.000000e+00</td></tr><tr><th>50%</th><td>2.126540e+05</td><td>5.555290e+05</td><td>8.210000e+02</td><td>2.459000e+03</td><td>4.065000e+03</td><td>1.010000e+03</td><td>0.000000e+00</td></tr><tr><th>75%</th><td>3.177500e+05</td><td>8.306890e+05</td><td>1.252000e+03</td><td>3.760000e+03</td><td>6.196000e+03</td><td>1.109000e+03</td><td>0.000000e+00</td></tr><tr><th>max</th><td>4.241700e+05</td><td>1.113166e+06</td><td>1.671000e+03</td><td>4.995000e+03</td><td>8.477000e+03</td><td>1.112000e+03</td><td>3.000000e+00</td></tr></tbody></table></div><h3 id="查看正负样本的分布并可视化">3.2查看正负样本的分布并可视化</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">label_gp = train_data.groupby(<span class="hljs-string">&#x27;label&#x27;</span>)[<span class="hljs-string">&#x27;user_id&#x27;</span>].count()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;正负样本的数量：\n&#x27;</span>,label_gp)<br>_,axe = plt.subplots(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,figsize=(<span class="hljs-number">12</span>,<span class="hljs-number">6</span>))<br>train_data.label.value_counts().plot(kind=<span class="hljs-string">&#x27;pie&#x27;</span>,autopct=<span class="hljs-string">&#x27;%1.1f%%&#x27;</span>,shadow=<span class="hljs-literal">True</span>,explode=[<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>],ax=axe[<span class="hljs-number">0</span>])<br>sns.countplot(x=<span class="hljs-string">&#x27;label&#x27;</span>,data=train_data,ax=axe[<span class="hljs-number">1</span>],)<br></code></pre></td></tr></table></figure><pre><code class="hljs">正负样本的数量：
 label
0    244912
1     15952
Name: user_id, dtype: int64





&lt;AxesSubplot:xlabel=&#39;label&#39;, ylabel=&#39;count&#39;&gt;</code></pre><p><img src="/img/天猫重复购买预测-02数据探索/output_37_2.png" srcset="/img/loading.gif" lazyload></p><p>从上图可以看出，样本的分布不均衡，需要采取一定的措施处理样本不均衡的问题：</p><ul><li>类似欠采样,将一份正样本和多分负样本组合成多分训练集,训练多个模型后求平均</li><li>调整模型的权重</li></ul><h4 id="代码解释">代码解释</h4><ol type="1"><li><code>_, axe = plt.subplots(1, 2, figsize=(12, 6))</code>: 创建一个包含两个子图的画布，并将其返回给 <code>_</code> 和 <code>axe</code>。这里使用了 <code>plt.subplots()</code> 方法创建画布，参数 <code>1, 2</code> 表示子图的行数和列数，<code>figsize=(12, 6)</code> 设置了画布的大小为 12x6。</li></ol><p><code>plt.subplots()</code> 方法返回一个包含子图的画布对象和子图对象的元组。<code>_</code> 是用来忽略画布对象的变量名，而 <code>axe</code> 是用来存储子图对象的变量名。通常情况下，我们只对子图对象进行操作和引用，因此将其赋值给 <code>axe</code> 变量以便后续使用。</p><ol start="2" type="1"><li><code>train_data.label.value_counts().plot(kind='pie', autopct='%1.1f%%', shadow=True, explode=[0, 0.1], ax=axe[0])</code>: 针对 <code>train_data</code> 数据集中的 <code>label</code> 列进行计数，并生成一个饼图。<code>value_counts()</code> 方法用于计算每个 label 的出现次数，<code>plot()</code> 方法用于绘制饼图。<code>kind='pie'</code> 设置图表类型为饼图，<code>autopct='%1.1f%%'</code> 设置饼图中每个部分的百分比显示格式，<code>shadow=True</code> 添加阴影效果，<code>explode=[0, 0.1]</code> 表示将第二个 label 分割出来以突出显示，<code>ax=axe[0]</code> 指定绘制在第一个子图上。</li></ol><p><code>explode=[0, 0.1]</code> 是设置饼图中各个扇形分离的程度的参数。<code>explode</code> 参数是一个列表，其中每个元素代表对应扇形与圆心的距离（以半径为单位）。具体来说，<code>[0, 0.1]</code> 表示第一个扇形不分离（与圆心距离为0），而第二个扇形与圆心分离出一个相对半径为0.1的距离。通过设置不同的 <code>explode</code> 参数，可以实现突出显示某些扇形的效果，使其凸出或分离出来以强调重要性或区分度。在这段代码中，通过 <code>explode=[0, 0.1]</code> 的设定，使得饼图中的第二个 label 扇形相对于圆心稍微分离出来。</p><ol start="3" type="1"><li><code>sns.countplot('label', data=train_data, ax=axe[1])</code>: 使用 seaborn 库的 <code>countplot()</code> 方法绘制柱状图。该方法用于显示某个变量（在这里是 <code>label</code> 列）的频数。<code>'label'</code> 是指定要绘制的变量名称，<code>data=train_data</code> 指定数据来源为 <code>train_data</code> 数据集，<code>ax=axe[1]</code> 指定绘制在第二个子图上。</li></ol><h2 id="探查影响复购的各种因素">4 探查影响复购的各种因素</h2><p>探查店铺、用户、性别以及年龄对复购的影响</p><h3 id="对店铺分析">4.1 对店铺分析</h3><p><strong>（1）分析不同店铺与复购关系，并可视化展示</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;选取top5店铺\n店铺\t购买次数&#x27;</span>)<br><span class="hljs-built_in">print</span>(train_data.merchant_id.value_counts().head(<span class="hljs-number">5</span>))<br>train_data_merchant = train_data.copy()<br>train_data_merchant[<span class="hljs-string">&#x27;TOP5&#x27;</span>] = train_data_merchant[<span class="hljs-string">&#x27;merchant_id&#x27;</span>].<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> [<span class="hljs-number">4044</span>,<span class="hljs-number">3828</span>,<span class="hljs-number">4173</span>,<span class="hljs-number">1102</span>,<span class="hljs-number">4976</span>] <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)<br>train_data_merchant = train_data_merchant[train_data_merchant[<span class="hljs-string">&#x27;TOP5&#x27;</span>]==<span class="hljs-number">1</span>]<br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))<br>plt.title(<span class="hljs-string">&#x27;Merchant VS Label&#x27;</span>)<br>ax = sns.countplot(x=<span class="hljs-string">&#x27;merchant_id&#x27;</span>,hue=<span class="hljs-string">&#x27;label&#x27;</span>,data=train_data_merchant)<br><span class="hljs-comment">#for p in ax.patches:</span><br>    <span class="hljs-comment">#height = p.get_height()</span><br></code></pre></td></tr></table></figure><pre><code class="hljs">选取top5店铺
店铺  购买次数
4044    3379
3828    3254
4173    2542
1102    2483
4976    1925
Name: merchant_id, dtype: int64</code></pre><p><img src="/img/天猫重复购买预测-02数据探索/output_43_1.png" srcset="/img/loading.gif" lazyload></p><p>从图可以看出不同店铺有不同复购率，可能与不同店铺售卖的商品有关，以及店铺的运营有关。</p><h4 id="代码解释-1">代码解释</h4><p>1、</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">train_data_merchant[<span class="hljs-string">&#x27;TOP5&#x27;</span>] = train_data_merchant[<span class="hljs-string">&#x27;merchant_id&#x27;</span>].<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x: <span class="hljs-number">1</span> <span class="hljs-keyword">if</span> x <span class="hljs-keyword">in</span> [<span class="hljs-number">4044</span>, <span class="hljs-number">3828</span>, <span class="hljs-number">4173</span>, <span class="hljs-number">1102</span>, <span class="hljs-number">4976</span>] <span class="hljs-keyword">else</span> <span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><ul><li><code>train_data_merchant['TOP5']</code>：使用 <code>train_data_merchant</code> 数据集的索引操作符 <code>[]</code>，选择 <code>train_data_merchant</code> 数据集的列 <code>'TOP5'</code>。</li><li><code>train_data_merchant['merchant_id']</code>：选择 <code>train_data_merchant</code> 数据集中的 <code>'merchant_id'</code> 列。</li><li><code>.map(lambda x: 1 if x in [4044, 3828, 4173, 1102, 4976] else 0)</code>：使用 <code>map()</code> 函数对 <code>'merchant_id'</code> 列中的每个值应用 lambda 函数进行映射。如果该值在 <code>[4044, 3828, 4173, 1102, 4976]</code> 中，则映射为 1，否则为 0。</li><li>最后，将得到的映射结果赋值给 <code>'TOP5'</code> 列，从而实现了对 <code>train_data_merchant</code> 数据集的新列的添加。</li></ul><p>2、<code>lambda</code></p><ol type="1"><li><p><code>lambda x:</code>：表示创建匿名函数，而 <code>x</code> 是匿名函数的参数。在本例中，<code>x</code> 用于表示 <code>merchant_id</code> 列中的每个值。</p></li><li><p><code>1 if x in [4044, 3828, 4173, 1102, 4976] else 0</code>：这是一个条件表达式，它根据 <code>x</code> 是否在 <code>[4044, 3828, 4173, 1102, 4976]</code> 列表中返回相应的值。</p><ul><li><p>如果 <code>x</code> 的值在列表 <code>[4044, 3828, 4173, 1102, 4976]</code> 中，条件成立，返回结果为 1。</p></li><li><p>如果 <code>x</code> 的值不在列表中，条件不成立，返回结果为 0。</p></li></ul></li><li><p><code>train_data_merchant['merchant_id'].map(lambda x: 1 if x in [4044, 3828, 4173, 1102, 4976] else 0)</code>：这行代码将 <code>lambda</code> 函数应用于 <code>merchant_id</code> 列中的每个值，并通过 <code>map()</code> 函数将映射结果赋值给 <code>TOP5</code> 列。</p><ul><li><p>对于 <code>merchant_id</code> 列中的每个值 <code>x</code>，<code>lambda</code> 函数根据条件表达式返回相应结果。</p></li><li><p>最终， <code>TOP5</code> 列将包含相应的映射结果，1 表示 <code>merchant_id</code> 值在 <code>[4044, 3828, 4173, 1102, 4976]</code> 中，0 表示不在其中。</p></li></ul></li></ol><p><strong>（2）查看店铺复购概率分布</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">merchant_repeat_buy = [ rate <span class="hljs-keyword">for</span> rate <span class="hljs-keyword">in</span> train_data.groupby([<span class="hljs-string">&#x27;merchant_id&#x27;</span>])[<span class="hljs-string">&#x27;label&#x27;</span>].mean() <span class="hljs-keyword">if</span> rate &lt;= <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> rate &gt; <span class="hljs-number">0</span>] <br><br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">4</span>))<br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)<br>sns.distplot(merchant_repeat_buy, fit=stats.norm)<br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<br>res = stats.probplot(merchant_repeat_buy, plot=plt)<br></code></pre></td></tr></table></figure><p>​<br><img src="/img/天猫重复购买预测-02数据探索/output_48_0.png" srcset="/img/loading.gif" lazyload> ​</p><p>这两幅图分别是概率密度图和概率图，反映了店铺的复购概率分布情况。可以看出不同店铺有不同复购率，大致在0-0.3之间</p><p>其中，概率密度图反映了复购概率的分布形态，以及是否满足正态分布假设。如果概率密度图接近正态分布曲线，则说明复购概率分布符合正态分布假设，否则说明分布形态可能存在偏差或者异常值。</p><p>概率图则反映了复购概率的数值范围和分布情况，包括四分位数、中位数、最大值、最小值等信息，可以帮助我们更直观地了解店铺复购概率的整体情况和分布特征。同时，通过比较不同店铺的概率图，可以看出不同店铺的复购概率分布情况是否存在明显差异。</p><h4 id="代码解释-2">代码解释</h4><p><code>train_data.groupby(['merchant_id'])['label'].mean()</code></p><p>这行代码对 <code>train_data</code> 数据集进行了分组操作，并计算了每个 <code>merchant_id</code> 对应的 <code>label</code> 列的均值。</p><ol type="1"><li><p><code>train_data.groupby(['merchant_id'])</code>：这部分代码使用 <code>groupby()</code> 函数将数据集按照 <code>merchant_id</code> 列进行分组。</p><ul><li><p><code>groupby()</code> 用于按照指定的列对数据进行分组。</p></li><li><p><code>['merchant_id']</code> 参数指定根据哪一列进行分组。</p></li></ul></li><li><p><code>['label'].mean()</code>：这部分代码在分组后的结果上，选择了 <code>label</code> 列，并调用 <code>mean()</code> 方法计算了均值。</p><ul><li><p><code>['label']</code> 表示从分组结果中选择了 <code>label</code> 列。</p></li><li><p><code>.mean()</code> 是 pandas 的一个方法，计算了选定列的均值。</p></li></ul></li></ol><p>最终，这行代码将返回一个以 <code>merchant_id</code> 为索引的 Series 对象，其中包含每个 <code>merchant_id</code> 对应的 <code>label</code> 列的均值。</p><p>例如，如果有以下数据：</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">merchant_id</span>   label<br>    <span class="hljs-attribute">M1</span>          <span class="hljs-number">1</span><br>    <span class="hljs-attribute">M1</span>          <span class="hljs-number">0</span><br>    <span class="hljs-attribute">M2</span>          <span class="hljs-number">0</span><br>    <span class="hljs-attribute">M2</span>          <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>那么执行 <code>train_data.groupby(['merchant_id'])['label'].mean()</code> 的结果将是：</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs erlang">merchant_id<br>    M1       <span class="hljs-number">0.5</span><br>    M2       <span class="hljs-number">0.5</span><br>    ...<br></code></pre></td></tr></table></figure><p>其中，<code>M1</code> 对应的均值为 <code>0.5</code>，<code>M2</code> 对应的均值也为 <code>0.5</code>。</p><h3 id="对用户分析">4.2 对用户分析</h3><p>查看用户复购率分布</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">user_repeat_buy = [rate <span class="hljs-keyword">for</span> rate <span class="hljs-keyword">in</span> train_data.groupby([<span class="hljs-string">&#x27;user_id&#x27;</span>])[<span class="hljs-string">&#x27;label&#x27;</span>].mean() <span class="hljs-keyword">if</span> rate &lt;= <span class="hljs-number">1</span> <span class="hljs-keyword">and</span> rate &gt; <span class="hljs-number">0</span>] <br><br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">6</span>))<br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)<br>sns.distplot(user_repeat_buy, fit=stats.norm)<br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<br>res = stats.probplot(user_repeat_buy, plot=plt)<br></code></pre></td></tr></table></figure><p>​<br><img src="/img/天猫重复购买预测-02数据探索/output_53_0.png" srcset="/img/loading.gif" lazyload> ​</p><p>可以看出近6个月，用户复购率很小，基本买一次为主</p><h3 id="对用户性别分析">4.3 对用户性别分析</h3><p><strong>（1）分析用户性别与复购的关系</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">train_data_user_info = train_data.merge(user_info,on=[<span class="hljs-string">&#x27;user_id&#x27;</span>],how=<span class="hljs-string">&#x27;left&#x27;</span>)<br><br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">8</span>))<br>plt.title(<span class="hljs-string">&#x27;Gender VS Label&#x27;</span>)<br>ax = sns.countplot(x=<span class="hljs-string">&#x27;gender&#x27;</span>,hue=<span class="hljs-string">&#x27;label&#x27;</span>,data=train_data_user_info)<br><span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> ax.patches:<br>    height = p.get_height()<br></code></pre></td></tr></table></figure><p>​<br><img src="/img/天猫重复购买预测-02数据探索/output_57_0.png" srcset="/img/loading.gif" lazyload> ​</p><h4 id="代码解释-3">代码解释</h4><p><code>train_data_user_info = train_data.merge(user_info,on=['user_id'],how='left')</code></p><p>将 <code>train_data</code> 数据集和 <code>user_info</code> 用户信息数据集按照 <code>user_id</code> 进行左连接（left join）操作，将两个数据集中的所有行按照 <code>user_id</code> 进行匹配，将匹配成功的行合并到一起。</p><p>其中 <code>train_data</code> 和 <code>user_info</code> 分别表示要进行连接的两个数据集，<code>on=['user_id']</code> 指定连接键为 <code>user_id</code> 列，<code>how='left'</code> 指定连接方式为左连接（即以 <code>train_data</code> 数据集为基础进行连接，将 <code>user_info</code> 数据集中匹配不上的行填充为缺失值）。最终，该代码将新生成一个包含用户信息的 <code>train_data_user_info</code> 数据集。</p><p><strong>(2)查看用户性别复购的分布</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">repeat_buy = [rate <span class="hljs-keyword">for</span> rate <span class="hljs-keyword">in</span> train_data_user_info.groupby([<span class="hljs-string">&#x27;gender&#x27;</span>])[<span class="hljs-string">&#x27;label&#x27;</span>].mean()] <br><br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">4</span>))<br><br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)<br>sns.distplot(repeat_buy, fit=stats.norm)<br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<br>res = stats.probplot(repeat_buy, plot=plt)<br></code></pre></td></tr></table></figure><p>​<br><img src="/img/天猫重复购买预测-02数据探索/output_61_0.png" srcset="/img/loading.gif" lazyload> ​</p><p>可以看出男女的复购率不一样</p><p>​</p><h3 id="对用户年龄分析">4.3 对用户年龄分析</h3><p><strong>（1）查看用户年龄与复购的关系</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">8</span>))<br>plt.title(<span class="hljs-string">&#x27;Age VS Label&#x27;</span>)<br>ax = sns.countplot(x=<span class="hljs-string">&#x27;age_range&#x27;</span>,hue=<span class="hljs-string">&#x27;label&#x27;</span>,data=train_data_user_info)<br></code></pre></td></tr></table></figure><p>​<br><img src="/img/天猫重复购买预测-02数据探索/output_65_0.png" srcset="/img/loading.gif" lazyload> ​</p><p><strong>(2)查看用户年龄复购的分布</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">repeat_buy = [rate <span class="hljs-keyword">for</span> rate <span class="hljs-keyword">in</span> train_data_user_info.groupby([<span class="hljs-string">&#x27;age_range&#x27;</span>])[<span class="hljs-string">&#x27;label&#x27;</span>].mean()] <br><br>plt.figure(figsize=(<span class="hljs-number">8</span>,<span class="hljs-number">4</span>))<br><br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>)<br>sns.distplot(repeat_buy, fit=stats.norm)<br>ax=plt.subplot(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)<br>res = stats.probplot(repeat_buy, plot=plt)<br></code></pre></td></tr></table></figure><p>​<br><img src="/img/天猫重复购买预测-02数据探索/output_68_0.png" srcset="/img/loading.gif" lazyload> ​</p><p>可以看出不同年龄段，复购概率不同</p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98%E5%85%A5%E9%97%A8/" class="category-chain-item">机器学习实战入门</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/">#机器学习</a></div></div><div class="license-box my-3"><div class="license-title"><div>天猫重复购买预测-02数据探索</div><div>http://zhou1317fe5.link/2023/12/02/天猫重复购买预测-02数据探索/</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>Zhou1317fe5</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2023年12月2日</div></div><div class="license-meta-item"><div>许可协议</div><div><a target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2024/02/07/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0-Course1-Week1%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0%E5%BC%95%E8%A8%80/" title="深度学习-Course1_Week1深度学习引言"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">深度学习-Course1_Week1深度学习引言</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/2023/10/18/SEED2023%E6%96%B0%E8%83%BD%E6%BA%90%E8%B5%9B%E9%81%93-%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2/" title="SEED2023新能源赛道-数据探索"><span class="hidden-mobile">SEED2023新能源赛道-数据探索</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="margin-left:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="busuanzi_container_site_pv" style="display:none">总访问量 <span id="busuanzi_value_site_pv"></span> 次 </span><span id="busuanzi_container_site_uv" style="display:none">总访客数 <span id="busuanzi_value_site_uv"></span> 人</span></div></div></footer><script src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js"></script><script src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var i=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-i},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>